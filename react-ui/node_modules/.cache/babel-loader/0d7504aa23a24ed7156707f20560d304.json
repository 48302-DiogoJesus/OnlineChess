{"ast":null,"code":"import CONFIG from'./config';import Alerts from'../utils/Alerts/sa-alerts';import State from'../state/State';var AXIOSI=CONFIG.AXIOSINSTANCE;// Private\nfunction responseIntercept(response){var showPopupOnError=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(response.status<200||response.status>=400){// If not authorized logout to avoid visual bugs\nif(response.status==401){State.logout();}var responseAsError=response.data.error;if(showPopupOnError)Alerts.showNotification(responseAsError.message);return{success:false,data:responseAsError};}return{success:true,data:response.data.data};}function handleRequestError(err){return{success:false,data:{http_code:503,message:err.message==\"Network Error\"?\"Server is Offline\":err.message}};}// PUBLIC FUNCTIONS\nvar logout=function logout(){return AXIOSI.get('/auth/logout').then(function(res){return responseIntercept(res,false);}).catch(function(err){return handleRequestError(err);});};var getGame=function getGame(game_id){return AXIOSI.get(\"/games?id=\".concat(game_id)).then(function(res){return responseIntercept(res,false);}).catch(function(err){return handleRequestError(err);});};var tryLogin=function tryLogin(username,password){return AXIOSI.post('/auth',{username:username,password:password}).then(function(res){return responseIntercept(res);}).catch(function(err){return handleRequestError(err);});};var trySignup=function trySignup(username,password){return AXIOSI.post('/users',{username:username,password:password}).then(function(res){return responseIntercept(res);}).catch(function(err){return handleRequestError(err);});};var createGame=function createGame(game_id){var is_public=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var opponent=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return AXIOSI.post(\"/games\",{id:game_id,public:is_public,player2:opponent}).then(function(res){return responseIntercept(res);}).catch(function(err){return handleRequestError(err);});};var joinAsPlayerB=function joinAsPlayerB(game_id){return AXIOSI.get(\"/games/connect?id=\".concat(game_id)).then(function(res){return responseIntercept(res);}).catch(function(err){return handleRequestError(err);});};var makeMove=function makeMove(game_id,move){return AXIOSI.get(\"/games/makemove?id=\".concat(game_id,\"&move=\").concat(move)).then(function(res){return responseIntercept(res);}).catch(function(err){return handleRequestError(err);});};var incrementViewers=function incrementViewers(game_id){return AXIOSI.post('/games/incrementviewers',{id:game_id}).then(function(res){return responseIntercept(res);}).catch(function(err){return handleRequestError(err);});};var Server={// Game\ncreateGame:createGame,getGame:getGame,joinAsPlayerB:joinAsPlayerB,makeMove:makeMove,incrementViewers:incrementViewers,// Authentication\nlogout:logout,tryLogin:tryLogin,trySignup:trySignup};export default Server;","map":{"version":3,"sources":["C:/Users/jesus/Desktop/PG/Personal/1-Web/TS/OnlineChess/onlinechess/src/server/server.ts"],"names":["CONFIG","Alerts","State","AXIOSI","AXIOSINSTANCE","responseIntercept","response","showPopupOnError","status","logout","responseAsError","data","error","showNotification","message","success","handleRequestError","err","http_code","get","then","res","catch","getGame","game_id","tryLogin","username","password","post","trySignup","createGame","is_public","opponent","id","public","player2","joinAsPlayerB","makeMove","move","incrementViewers","Server"],"mappings":"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","sourcesContent":["import { AxiosResponse } from 'axios'\r\nimport CONFIG from './config'\r\n\r\nimport Alerts from '../utils/Alerts/sa-alerts'\r\nimport State from '../state/State'\r\nimport { PieceColor } from '../domain/piece'\r\n\r\nconst AXIOSI = CONFIG.AXIOSINSTANCE\r\n\r\n// Private\r\nexport interface ServerError {\r\n    http_code: number,\r\n    message: string\r\n}\r\n\r\nexport interface ServerResponse {\r\n    success: boolean,\r\n    data: any | ServerError\r\n}\r\n\r\nexport interface RemoteGame {\r\n    _id: string,\r\n    player_w: string,   // username of player1\r\n    player_b: string | null,  // username of player2\r\n\r\n    moves: string[],\r\n    winner: PieceColor | null,\r\n    views: number\r\n}\r\n\r\n\r\nfunction responseIntercept(response: AxiosResponse, showPopupOnError: boolean = true): ServerResponse {\r\n    if (response.status < 200 || response.status >= 400) {\r\n        // If not authorized logout to avoid visual bugs\r\n        if (response.status == 401) {\r\n            State.logout()\r\n        }\r\n        const responseAsError = response.data.error as ServerError\r\n        if (showPopupOnError)\r\n            Alerts.showNotification(responseAsError.message)\r\n        return { success: false, data: responseAsError }\r\n    }\r\n    return { success: true, data: response.data.data }\r\n}\r\n\r\nfunction handleRequestError(err: any): ServerResponse {\r\n    return {\r\n        success: false,\r\n        data: {\r\n            http_code: 503,\r\n            message: err.message == \"Network Error\"\r\n                ? \"Server is Offline\"\r\n                : err.message,\r\n        }\r\n    }\r\n}\r\n\r\n// PUBLIC FUNCTIONS\r\nconst logout = (): Promise<ServerResponse> =>\r\n    AXIOSI.get('/auth/logout')\r\n        .then((res: AxiosResponse) => responseIntercept(res, false))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst getGame = (game_id: string): Promise<ServerResponse> =>\r\n    AXIOSI.get(`/games?id=${game_id}`)\r\n        .then((res: AxiosResponse) => responseIntercept(res, false))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst tryLogin = (username: string, password: string): Promise<ServerResponse> =>\r\n    AXIOSI.post('/auth', {\r\n        username: username,\r\n        password: password\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst trySignup = (username: string, password: string): Promise<ServerResponse> =>\r\n    AXIOSI.post('/users', {\r\n        username: username,\r\n        password: password\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst createGame = (game_id: string, is_public: boolean = true, opponent: string | null = null): Promise<ServerResponse> =>\r\n    AXIOSI.post(`/games`, {\r\n        id: game_id,\r\n        public: is_public,\r\n        player2: opponent\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst joinAsPlayerB = (game_id: string): Promise<ServerResponse> =>\r\n    AXIOSI.get(`/games/connect?id=${game_id}`)\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\nconst makeMove = (game_id: string, move: string): Promise<ServerResponse> =>\r\n    AXIOSI.get(`/games/makemove?id=${game_id}&move=${move}`)\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\nconst incrementViewers = (game_id: string) =>\r\n    AXIOSI.post('/games/incrementviewers', {\r\n        id: game_id\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\nconst Server = {\r\n    // Game\r\n    createGame,\r\n    getGame,\r\n    joinAsPlayerB,\r\n    makeMove,\r\n    incrementViewers,\r\n\r\n    // Authentication\r\n    logout,\r\n    tryLogin,\r\n    trySignup\r\n}\r\n\r\nexport default Server"]},"metadata":{},"sourceType":"module"}