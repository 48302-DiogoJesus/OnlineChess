{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\jesus\\\\Desktop\\\\PG\\\\Personal\\\\1-Web\\\\TS\\\\OnlineChess\\\\onlinechess\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import'./board.css';import Tile,{TileColor}from'../Tile/Tile';import{Move,moveToString,Position}from'../../../../../domain/position';import{useState}from'react';import Alerts from'../../../../../utils/Alerts/sa-alerts';import{jsx as _jsx}from\"react/jsx-runtime\";var initSelectedTile={tile:null};var initTargetTiles=[];export default function Board(props){var _useState=useState(initSelectedTile),_useState2=_slicedToArray(_useState,2),selectedTile=_useState2[0],setSelectedTile=_useState2[1];var _useState3=useState(initTargetTiles),_useState4=_slicedToArray(_useState3,2),targetTiles=_useState4[0],setTargetTiles=_useState4[1];var board=props.board;function buildTile(row,column,piece){return/*#__PURE__*/_jsx(Tile,{piece:board.getPieceAt(Position(column,row))// Tile state\n,selected:isSelected(row,column),target:isTarget(row,column)// DARK or LIGHT \n,color:calcTileColor(row,column)// Position\n,position:Position(column,row)// Events\n,onTileClick:function onTileClick(){return handleTileClick(row,column,piece);}});}var calcTileColor=function calcTileColor(row,col){return(col+row)%2===0?TileColor.LIGHT:TileColor.DARK;};var isTarget=function isTarget(row,col){return!props.game_over&&targetTiles.find(function(pos){return pos.row===row&&pos.column===col;})!=undefined;};var isSelected=function isSelected(row,col){var _selectedTile$tile,_selectedTile$tile2;return!props.game_over&&row==((_selectedTile$tile=selectedTile.tile)===null||_selectedTile$tile===void 0?void 0:_selectedTile$tile.row)&&col==((_selectedTile$tile2=selectedTile.tile)===null||_selectedTile$tile2===void 0?void 0:_selectedTile$tile2.column);};var handleTileClick=function handleTileClick(row,col,pieceClicked){setSelectedTile({tile:null});setTargetTiles([]);if(props.game_over||props.isViewer)return;if(!props.singleplayer&&board.turn!=props.local_player_pieces){Alerts.showNotification(\"Not your turn\");return;}var positionClicked=Position(col,row);// 1. TILE IS SELECTED\nif((selectedTile===null||selectedTile===void 0?void 0:selectedTile.tile)!=null){// CLICKED SELECTED TILE AGAIN. JUST UNSELECT\nif(isSelected(positionClicked.row,positionClicked.column)){return;}// CLICKED A TARGET - MAKE MOVE\nif(isTarget(positionClicked.row,positionClicked.column)){var selectedPiece=board.getPieceAt(selectedTile.tile);// board.makeMove(moveToString(Move(selectedPiece!!.toString(), selectedTile.tile, positionClicked)))\nprops.onMakeMove(moveToString(Move(selectedPiece.toString(),selectedTile.tile,positionClicked)));return;}// Select a tile + Show Possible Targets\nif((pieceClicked===null||pieceClicked===void 0?void 0:pieceClicked.color)==props.local_player_pieces){setSelectedTile({tile:positionClicked});var targets=Array.from(board.generateAllPossibleTargets(positionClicked));setTargetTiles(targets);}}// 2. TILE IS NOT SELECTED\nelse{// Select a tile + Show Possible Targets\nif((pieceClicked===null||pieceClicked===void 0?void 0:pieceClicked.color)==props.local_player_pieces){setSelectedTile({tile:positionClicked});var _targets=Array.from(board.generateAllPossibleTargets(positionClicked));setTargetTiles(_targets);}}};return/*#__PURE__*/_jsx(\"div\",{className:\"board\",children:/*#__PURE__*/_jsx(\"div\",{children:board.board.map(function(row,rowIdx){return/*#__PURE__*/_jsx(\"div\",{className:\"board-row\",children:row.map(function(piece,colIdx){return buildTile(rowIdx,colIdx,piece);})});})})});}","map":{"version":3,"sources":["C:/Users/jesus/Desktop/PG/Personal/1-Web/TS/OnlineChess/onlinechess/src/pages/GamePage/components/ChessBoard/Board/Board.tsx"],"names":["Tile","TileColor","Move","moveToString","Position","useState","Alerts","initSelectedTile","tile","initTargetTiles","Board","props","selectedTile","setSelectedTile","targetTiles","setTargetTiles","board","buildTile","row","column","piece","getPieceAt","isSelected","isTarget","calcTileColor","handleTileClick","col","LIGHT","DARK","game_over","find","pos","undefined","pieceClicked","isViewer","singleplayer","turn","local_player_pieces","showNotification","positionClicked","selectedPiece","onMakeMove","toString","color","targets","Array","from","generateAllPossibleTargets","map","rowIdx","colIdx"],"mappings":"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","sourcesContent":["import './board.css'\r\n\r\nimport Tile, { TileColor } from '../Tile/Tile';\r\nimport { BoardObject } from '../../../../../domain/board'\r\nimport { Move, moveToString, Position, PositionObject } from '../../../../../domain/position'\r\nimport { BoardError } from '../../../../../domain/errors';\r\nimport { Piece, PieceColor } from '../../../../../domain/piece';\r\nimport { useState } from 'react';\r\nimport Alerts from '../../../../../utils/Alerts/sa-alerts';\r\n\r\ninterface TileWrapper { tile: PositionObject | null }\r\n\r\nconst initSelectedTile: TileWrapper = { tile: null }\r\nconst initTargetTiles: PositionObject[] = []\r\n\r\nexport default function Board(\r\n  props: {\r\n    singleplayer: boolean\r\n\r\n    board: BoardObject,\r\n    local_player_pieces: PieceColor\r\n\r\n    isViewer: boolean\r\n    game_over: boolean\r\n\r\n    turn: PieceColor\r\n\r\n    onMakeMove: (move: string) => void\r\n    onError: (error: BoardError) => void\r\n  }\r\n) {\r\n\r\n  const [selectedTile, setSelectedTile] = useState(initSelectedTile)\r\n  const [targetTiles, setTargetTiles] = useState(initTargetTiles)\r\n  const board = props.board\r\n\r\n  function buildTile(row: number, column: number, piece: Piece | null) {\r\n    return (\r\n      <Tile\r\n        piece={board.getPieceAt(Position(column, row))}\r\n\r\n        // Tile state\r\n        selected={isSelected(row, column)}\r\n        target={isTarget(row, column)}\r\n\r\n        // DARK or LIGHT \r\n        color={calcTileColor(row, column)}\r\n\r\n        // Position\r\n        position={Position(column, row)}\r\n\r\n        // Events\r\n        onTileClick={() => handleTileClick(row, column, piece)}\r\n      />\r\n    )\r\n  }\r\n\r\n  const calcTileColor = (row: number, col: number) =>\r\n    (col + row) % 2 === 0 ? TileColor.LIGHT : TileColor.DARK\r\n\r\n  const isTarget = (row: number, col: number) =>\r\n    !props.game_over && targetTiles.find((pos) => pos.row === row && pos.column === col) != undefined\r\n\r\n  const isSelected = (row: number, col: number) =>\r\n    !props.game_over && (row == selectedTile.tile?.row && col == selectedTile.tile?.column)\r\n\r\n  const handleTileClick = (row: number, col: number, pieceClicked: Piece | null) => {\r\n    setSelectedTile({ tile: null })\r\n    setTargetTiles([])\r\n\r\n    if (props.game_over || props.isViewer)\r\n      return\r\n\r\n    if (!props.singleplayer && board.turn != props.local_player_pieces) {\r\n      Alerts.showNotification(\"Not your turn\")\r\n      return\r\n    }\r\n\r\n    const positionClicked = Position(col, row)\r\n\r\n    // 1. TILE IS SELECTED\r\n    if (selectedTile?.tile != null) {\r\n\r\n      // CLICKED SELECTED TILE AGAIN. JUST UNSELECT\r\n      if (isSelected(positionClicked.row, positionClicked.column)) {\r\n        return\r\n      }\r\n      // CLICKED A TARGET - MAKE MOVE\r\n      if (isTarget(positionClicked.row, positionClicked.column)) {\r\n        const selectedPiece = board.getPieceAt(selectedTile.tile)\r\n        // board.makeMove(moveToString(Move(selectedPiece!!.toString(), selectedTile.tile, positionClicked)))\r\n        props.onMakeMove(moveToString(Move(selectedPiece!!.toString(), selectedTile.tile, positionClicked)))\r\n        return\r\n      }\r\n\r\n      // Select a tile + Show Possible Targets\r\n      if (pieceClicked?.color == props.local_player_pieces) {\r\n        setSelectedTile({ tile: positionClicked })\r\n        const targets = Array.from(board.generateAllPossibleTargets(positionClicked))\r\n        setTargetTiles(targets)\r\n      }\r\n    }\r\n    // 2. TILE IS NOT SELECTED\r\n    else {\r\n      // Select a tile + Show Possible Targets\r\n      if (pieceClicked?.color == props.local_player_pieces) {\r\n        setSelectedTile({ tile: positionClicked })\r\n        const targets = Array.from(board.generateAllPossibleTargets(positionClicked))\r\n        setTargetTiles(targets)\r\n      }\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"board\">\r\n      <div>\r\n        {\r\n          board.board.map((row, rowIdx) => {\r\n            return (\r\n              <div className=\"board-row\">\r\n                {row.map((piece, colIdx) => buildTile(rowIdx, colIdx, piece))}\r\n              </div>\r\n            )\r\n          }\r\n          )\r\n        }\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}