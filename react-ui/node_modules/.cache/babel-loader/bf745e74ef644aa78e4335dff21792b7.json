{"ast":null,"code":"import CONFIG from './config';\nimport Alerts from '../utils/Alerts/sa-alerts';\nimport State from '../state/State';\nconst AXIOSI = CONFIG.AXIOSINSTANCE; // Private\n\nfunction responseIntercept(response) {\n  let showPopupOnError = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n  if (response.status < 200 || response.status >= 400) {\n    // If not authorized logout to avoid visual bugs\n    if (response.status == 401) {\n      State.logout();\n    }\n\n    const responseAsError = response.data.error;\n    if (showPopupOnError) Alerts.showNotification(responseAsError.message);\n    return {\n      success: false,\n      data: responseAsError\n    };\n  }\n\n  return {\n    success: true,\n    data: response.data.data\n  };\n}\n\nfunction handleRequestError(err) {\n  return {\n    success: false,\n    data: {\n      http_code: 503,\n      message: err.message == \"Network Error\" ? \"Server is Offline\" : err.message\n    }\n  };\n} // PUBLIC FUNCTIONS\n\n\nconst logout = () => AXIOSI.get('/auth/logout', {\n  headers: {\n    'Authorization': 'Bearer ' + State.getAppState().authentication.token\n  }\n}).then(res => responseIntercept(res, false)).catch(err => handleRequestError(err));\n\nconst getGame = game_id => AXIOSI.get(`/games?id=${game_id}`, {\n  headers: {\n    'Authorization': 'Bearer ' + State.getAppState().authentication.token\n  }\n}).then(res => responseIntercept(res, false)).catch(err => handleRequestError(err));\n\nconst tryLogin = (username, password) => AXIOSI.post('/auth', {\n  headers: {\n    'Authorization': 'Bearer ' + State.getAppState().authentication.token\n  },\n  username: username,\n  password: password\n}).then(res => responseIntercept(res)).catch(err => handleRequestError(err));\n\nconst trySignup = (username, password) => AXIOSI.post('/users', {\n  headers: {\n    'Authorization': 'Bearer ' + State.getAppState().authentication.token\n  },\n  username: username,\n  password: password\n}).then(res => responseIntercept(res)).catch(err => handleRequestError(err));\n\nconst createGame = function (game_id) {\n  let is_public = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  let opponent = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  return AXIOSI.post(`/games`, {\n    headers: {\n      'Authorization': 'Bearer ' + State.getAppState().authentication.token\n    },\n    id: game_id,\n    public: is_public,\n    player2: opponent\n  }).then(res => responseIntercept(res)).catch(err => handleRequestError(err));\n};\n\nconst joinAsPlayerB = game_id => AXIOSI.get(`/games/connect?id=${game_id}`, {\n  headers: {\n    'Authorization': 'Bearer ' + State.getAppState().authentication.token\n  }\n}).then(res => responseIntercept(res)).catch(err => handleRequestError(err));\n\nconst makeMove = (game_id, move) => AXIOSI.get(`/games/makemove?id=${game_id}&move=${move}`, {\n  headers: {\n    'Authorization': 'Bearer ' + State.getAppState().authentication.token\n  }\n}).then(res => responseIntercept(res)).catch(err => handleRequestError(err));\n\nconst incrementViewers = game_id => AXIOSI.post('/games/incrementviewers', {\n  headers: {\n    'Authorization': 'Bearer ' + State.getAppState().authentication.token\n  },\n  id: game_id\n}).then(res => responseIntercept(res)).catch(err => handleRequestError(err));\n\nconst Server = {\n  // Game\n  createGame,\n  getGame,\n  joinAsPlayerB,\n  makeMove,\n  incrementViewers,\n  // Authentication\n  logout,\n  tryLogin,\n  trySignup\n};\nexport default Server;","map":{"version":3,"sources":["C:/Users/jesus/Desktop/PG/Personal/1-Web/TS/OnlineChess/onlinechess/src/server/server.ts"],"names":["CONFIG","Alerts","State","AXIOSI","AXIOSINSTANCE","responseIntercept","response","showPopupOnError","status","logout","responseAsError","data","error","showNotification","message","success","handleRequestError","err","http_code","get","headers","getAppState","authentication","token","then","res","catch","getGame","game_id","tryLogin","username","password","post","trySignup","createGame","is_public","opponent","id","public","player2","joinAsPlayerB","makeMove","move","incrementViewers","Server"],"mappings":"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","sourcesContent":["import { AxiosInstance, AxiosResponse } from 'axios'\r\nimport CONFIG from './config'\r\n\r\nimport Alerts from '../utils/Alerts/sa-alerts'\r\nimport State from '../state/State'\r\nimport { PieceColor } from '../domain/piece'\r\n\r\nconst AXIOSI = CONFIG.AXIOSINSTANCE\r\n\r\n// Private\r\nexport interface ServerError {\r\n    http_code: number,\r\n    message: string\r\n}\r\n\r\nexport interface ServerResponse {\r\n    success: boolean,\r\n    data: any | ServerError\r\n}\r\n\r\nexport interface RemoteGame {\r\n    _id: string,\r\n    player_w: string,   // username of player1\r\n    player_b: string | null,  // username of player2\r\n\r\n    moves: string[],\r\n    winner: PieceColor | null,\r\n    views: number\r\n}\r\n\r\n\r\nfunction responseIntercept(response: AxiosResponse, showPopupOnError: boolean = true): ServerResponse {\r\n    if (response.status < 200 || response.status >= 400) {\r\n        // If not authorized logout to avoid visual bugs\r\n        if (response.status == 401) {\r\n            State.logout()\r\n        }\r\n        const responseAsError = response.data.error as ServerError\r\n        if (showPopupOnError)\r\n            Alerts.showNotification(responseAsError.message)\r\n        return { success: false, data: responseAsError }\r\n    }\r\n    return { success: true, data: response.data.data }\r\n}\r\n\r\nfunction handleRequestError(err: any): ServerResponse {\r\n    return {\r\n        success: false,\r\n        data: {\r\n            http_code: 503,\r\n            message: err.message == \"Network Error\"\r\n                ? \"Server is Offline\"\r\n                : err.message,\r\n        }\r\n    }\r\n}\r\n\r\n// PUBLIC FUNCTIONS\r\nconst logout = (): Promise<ServerResponse> =>\r\n    AXIOSI.get('/auth/logout', {\r\n        headers: { 'Authorization': 'Bearer ' + State.getAppState().authentication.token }\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res, false))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst getGame = (game_id: string): Promise<ServerResponse> =>\r\n    AXIOSI.get(`/games?id=${game_id}`, {\r\n        headers: { 'Authorization': 'Bearer ' + State.getAppState().authentication.token }\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res, false))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst tryLogin = (username: string, password: string): Promise<ServerResponse> =>\r\n    AXIOSI.post('/auth', {\r\n        headers: { 'Authorization': 'Bearer ' + State.getAppState().authentication.token },\r\n\r\n        username: username,\r\n        password: password\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst trySignup = (username: string, password: string): Promise<ServerResponse> =>\r\n    AXIOSI.post('/users', {\r\n        headers: { 'Authorization': 'Bearer ' + State.getAppState().authentication.token },\r\n\r\n        username: username,\r\n        password: password\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst createGame = (game_id: string, is_public: boolean = true, opponent: string | null = null): Promise<ServerResponse> =>\r\n    AXIOSI.post(`/games`, {\r\n        headers: { 'Authorization': 'Bearer ' + State.getAppState().authentication.token },\r\n        id: game_id,\r\n        public: is_public,\r\n        player2: opponent,\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\n\r\nconst joinAsPlayerB = (game_id: string): Promise<ServerResponse> =>\r\n    AXIOSI.get(`/games/connect?id=${game_id}`, {\r\n        headers: { 'Authorization': 'Bearer ' + State.getAppState().authentication.token },\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\nconst makeMove = (game_id: string, move: string): Promise<ServerResponse> =>\r\n    AXIOSI.get(`/games/makemove?id=${game_id}&move=${move}`, {\r\n        headers: { 'Authorization': 'Bearer ' + State.getAppState().authentication.token },\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\nconst incrementViewers = (game_id: string) =>\r\n    AXIOSI.post('/games/incrementviewers', {\r\n        headers: { 'Authorization': 'Bearer ' + State.getAppState().authentication.token },\r\n        id: game_id\r\n    })\r\n        .then((res: AxiosResponse) => responseIntercept(res))\r\n        .catch(err => handleRequestError(err))\r\n\r\nconst Server = {\r\n    // Game\r\n    createGame,\r\n    getGame,\r\n    joinAsPlayerB,\r\n    makeMove,\r\n    incrementViewers,\r\n\r\n    // Authentication\r\n    logout,\r\n    tryLogin,\r\n    trySignup\r\n}\r\n\r\nexport default Server"]},"metadata":{},"sourceType":"module"}