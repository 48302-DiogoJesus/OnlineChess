{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jesus\\\\Desktop\\\\PG\\\\Personal\\\\1-Web\\\\TS\\\\OnlineChess\\\\onlinechess\\\\src\\\\components\\\\ChessBoard\\\\Board\\\\Board.tsx\",\n    _s = $RefreshSig$();\n\nimport './board.css';\nimport Tile, { TileColor } from '../Tile/Tile';\nimport { BoardObject, stringToBoard } from '../../../domain/board';\nimport { Position } from '../../../domain/position';\nimport { useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initSelectedTile = {\n  tile: null\n};\nconst initTargetTiles = [];\nexport default function Board(props) {\n  _s();\n\n  const [selectedTile, setSelectedTile] = useState(initSelectedTile);\n  const [targetTiles, setTargetTiles] = useState(initTargetTiles);\n  const board = getBoardFromProps();\n\n  function getBoardFromProps() {\n    const boardAsString = props.boardString;\n    if (boardAsString == undefined) return new BoardObject();\n\n    try {\n      const convertedBoard = stringToBoard(boardAsString);\n      return convertedBoard;\n    } catch (e) {\n      const err = e;\n      err.message = `[DEBUG] Invalid Board: ${boardAsString.length} => ${boardAsString}\\nOriginal Error: ${err.message}`;\n      props.onError(err);\n    }\n\n    return new BoardObject();\n  }\n\n  function buildTile(row, column, piece) {\n    return /*#__PURE__*/_jsxDEV(Tile, {\n      piece: board.getPieceAt(Position(column, row)) // Tile state\n      ,\n      selected: isSelected(row, column),\n      target: isTarget(row, column) // DARK or LIGHT \n      ,\n      color: calcTileColor(row, column) // Position\n      ,\n      position: Position(column, row) // Events\n      ,\n      onTileClick: () => handleTileClick(row, column, piece)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 7\n    }, this);\n  }\n\n  const calcTileColor = (row, col) => (col + row) % 2 === 0 ? TileColor.LIGHT : TileColor.DARK;\n\n  const isTarget = (row, col) => targetTiles.find(pos => pos.row === row && pos.column === col) != undefined;\n\n  const isSelected = (row, col) => {\n    var _selectedTile$tile, _selectedTile$tile2;\n\n    return row == ((_selectedTile$tile = selectedTile.tile) === null || _selectedTile$tile === void 0 ? void 0 : _selectedTile$tile.row) && col == ((_selectedTile$tile2 = selectedTile.tile) === null || _selectedTile$tile2 === void 0 ? void 0 : _selectedTile$tile2.column);\n  };\n\n  const handleTileClick = (row, col, piece) => {\n    const clickPosition = Position(col, row);\n    console.log(`Clicked on ${col}:${row} | ${piece}`); // 1. TILE IS SELECTED\n\n    if ((selectedTile === null || selectedTile === void 0 ? void 0 : selectedTile.tile) != null) {\n      // CLICKED SELECTED TILE AGAIN. JUST UNSELECT\n      if (isSelected(clickPosition.row, clickPosition.column)) {\n        setSelectedTile({\n          tile: null\n        });\n        setTargetTiles([]);\n        return;\n      } // CLICKED A TARGET - MAKE MOVE\n\n\n      if (isTarget(clickPosition.row, clickPosition.column)) {\n        console.log(\"TARGET\");\n        return;\n      }\n    } // 2. TILE IS NOT SELECTED\n    else {\n      var _board$getPieceAt;\n\n      if (((_board$getPieceAt = board.getPieceAt(clickPosition)) === null || _board$getPieceAt === void 0 ? void 0 : _board$getPieceAt.color) == props.local_player_pieces) {\n        setSelectedTile({\n          tile: clickPosition\n        });\n        const targets = Array.from(board.generateAllPossibleTargets(clickPosition));\n        setTargetTiles(targets);\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"board\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      children: board === null || board === void 0 ? void 0 : board.board.map((row, rowIdx) => {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"board-row\",\n          children: row.map((piece, colIdx) => buildTile(rowIdx, colIdx, piece))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 15\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Board, \"m1vie7Op5i4AWdUuS5CIu49/DZ8=\");\n\n_c = Board;\n\nvar _c;\n\n$RefreshReg$(_c, \"Board\");","map":{"version":3,"sources":["C:/Users/jesus/Desktop/PG/Personal/1-Web/TS/OnlineChess/onlinechess/src/components/ChessBoard/Board/Board.tsx"],"names":["Tile","TileColor","BoardObject","stringToBoard","Position","useState","initSelectedTile","tile","initTargetTiles","Board","props","selectedTile","setSelectedTile","targetTiles","setTargetTiles","board","getBoardFromProps","boardAsString","boardString","undefined","convertedBoard","e","err","message","length","onError","buildTile","row","column","piece","getPieceAt","isSelected","isTarget","calcTileColor","handleTileClick","col","LIGHT","DARK","find","pos","clickPosition","console","log","color","local_player_pieces","targets","Array","from","generateAllPossibleTargets","map","rowIdx","colIdx"],"mappings":"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","sourcesContent":["import './board.css'\r\n\r\nimport Tile, { TileColor } from '../Tile/Tile';\r\nimport { BoardObject, stringToBoard } from '../../../domain/board'\r\nimport { Position, PositionObject } from '../../../domain/position'\r\nimport { BoardError } from '../../../domain/errors';\r\nimport { Piece, PieceColor } from '../../../domain/piece';\r\nimport { useState } from 'react';\r\n\r\ninterface TileWrapper { tile: PositionObject | null }\r\n\r\nconst initSelectedTile: TileWrapper = { tile: null }\r\nconst initTargetTiles: PositionObject[] = []\r\n\r\nexport default function Board(\r\n  props: {\r\n    boardString?: string,\r\n    local_player_pieces: PieceColor\r\n    onError: (error: BoardError) => void\r\n  }\r\n) {\r\n\r\n  const [selectedTile, setSelectedTile] = useState(initSelectedTile)\r\n  const [targetTiles, setTargetTiles] = useState(initTargetTiles)\r\n\r\n  const board = getBoardFromProps()\r\n\r\n  function getBoardFromProps(): BoardObject {\r\n    const boardAsString: string | undefined = props.boardString\r\n\r\n    if (boardAsString == undefined)\r\n      return new BoardObject()\r\n\r\n    try {\r\n      const convertedBoard = stringToBoard(boardAsString)\r\n      return convertedBoard\r\n    } catch (e: any) {\r\n      const err = e as BoardError\r\n      err.message = `[DEBUG] Invalid Board: ${boardAsString.length} => ${boardAsString}\\nOriginal Error: ${err.message}`\r\n      props.onError(err)\r\n    }\r\n    return new BoardObject()\r\n  }\r\n\r\n  function buildTile(row: number, column: number, piece: Piece | null) {\r\n    return (\r\n      <Tile\r\n        piece={board.getPieceAt(Position(column, row))}\r\n\r\n        // Tile state\r\n        selected={isSelected(row, column)}\r\n        target={isTarget(row, column)}\r\n\r\n        // DARK or LIGHT \r\n        color={calcTileColor(row, column)}\r\n\r\n        // Position\r\n        position={Position(column, row)}\r\n\r\n        // Events\r\n        onTileClick={() => handleTileClick(row, column, piece)}\r\n      />\r\n    )\r\n  }\r\n\r\n  const calcTileColor = (row: number, col: number) =>\r\n    (col + row) % 2 === 0 ? TileColor.LIGHT : TileColor.DARK\r\n\r\n  const isTarget = (row: number, col: number) =>\r\n    targetTiles.find((pos) => pos.row === row && pos.column === col) != undefined\r\n\r\n  const isSelected = (row: number, col: number) =>\r\n    (row == selectedTile.tile?.row && col == selectedTile.tile?.column)\r\n\r\n  const handleTileClick = (row: number, col: number, piece: Piece | null) => {\r\n    const clickPosition = Position(col, row)\r\n    console.log(`Clicked on ${col}:${row} | ${piece}`)\r\n\r\n    // 1. TILE IS SELECTED\r\n    if (selectedTile?.tile != null) {\r\n      // CLICKED SELECTED TILE AGAIN. JUST UNSELECT\r\n      if (isSelected(clickPosition.row, clickPosition.column)) {\r\n        setSelectedTile({ tile: null })\r\n        setTargetTiles([])\r\n        return\r\n      }\r\n      // CLICKED A TARGET - MAKE MOVE\r\n      if (isTarget(clickPosition.row, clickPosition.column)) {\r\n        console.log(\"TARGET\")\r\n        return\r\n      }\r\n    }\r\n    // 2. TILE IS NOT SELECTED\r\n    else {\r\n      if (board.getPieceAt(clickPosition)?.color == props.local_player_pieces) {\r\n        setSelectedTile({ tile: clickPosition })\r\n        const targets = Array.from(board.generateAllPossibleTargets(clickPosition))\r\n        setTargetTiles(targets)\r\n      }\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"board\">\r\n      <div>\r\n        {\r\n          board?.board.map((row, rowIdx) => {\r\n            return (\r\n              <div className=\"board-row\">\r\n                {row.map((piece, colIdx) => buildTile(rowIdx, colIdx, piece))}\r\n              </div>\r\n            )\r\n          }\r\n          )\r\n        }\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}